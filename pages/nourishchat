import streamlit as st
import gspread
from oauth2client.service_account import ServiceAccountCredentials
import pandas as pd

st.title("NourishChat: Personalized Pantry Recommendations")

# Set up credentials for Google Sheets
scope = ["https://spreadsheets.google.com/feeds", "https://www.googleapis.com/auth/drive"]

if "google_sheets" in st.secrets:
    creds = ServiceAccountCredentials.from_json_keyfile_dict(st.secrets["google_sheets"], scope)
else:
    creds = ServiceAccountCredentials.from_json_keyfile_name("credentials/nourishnet-creds.json", scope)

client = gspread.authorize(creds)
sheet = client.open("NourishNet Confirmations").sheet1

# Fetch data from Google Sheet
data = sheet.get_all_records()
df = pd.DataFrame(data)

# User input for dietary preferences
st.sidebar.header("Filter by Dietary Needs")
vegetarian = st.sidebar.checkbox("Vegetarian")
vegan = st.sidebar.checkbox("Vegan")
gluten_free = st.sidebar.checkbox("Gluten-Free")

# Filter logic
filtered_df = df.copy()
if vegetarian:
    filtered_df = filtered_df[filtered_df['Tags'].str.contains("vegetarian", case=False)]
if vegan:
    filtered_df = filtered_df[filtered_df['Tags'].str.contains("vegan", case=False)]
if gluten_free:
    filtered_df = filtered_df[filtered_df['Tags'].str.contains("gluten-free", case=False)]

st.subheader("Available Items Matching Your Preferences")
st.dataframe(filtered_df[['Item', 'Count', 'Tags']])
